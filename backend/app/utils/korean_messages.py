"""
í•œêµ­ì–´ UX ë©”ì‹œì§€ ìœ í‹¸ë¦¬í‹°
í†¤ì•¤ë§¤ë„ˆ: ì¹œì ˆí•˜ê³  ê²©ë ¤í•˜ëŠ” ë§íˆ¬, ìœ„í˜‘ì ì´ê±°ë‚˜ ìˆ˜ì¹˜ì‹¬ ìœ ë°œí•˜ì§€ ì•ŠìŒ
"""

import random
from datetime import datetime
from typing import Dict, List, Optional

class KoreanMessageGenerator:
    """í•œêµ­ì–´ UX ë©”ì‹œì§€ ìƒì„±ê¸°"""
    
    def __init__(self):
        self.greeting_messages = {
            "morning": [
                "ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”! ì˜¤ëŠ˜ë„ ì§€êµ¬ë¥¼ ì§€í‚¤ëŠ” í•˜ë£¨ ë˜ì„¸ìš” ğŸŒ…",
                "ìƒì¾Œí•œ ì•„ì¹¨ì´ë„¤ìš”! ì˜¤ëŠ˜ì€ ì–´ë–¤ ë§›ìˆëŠ” ì„ íƒì„ í•˜ì‹¤ ê±´ê°€ìš”? â˜€ï¸",
                "ìƒˆë¡œìš´ í•˜ë£¨ì˜ ì‹œì‘! í™˜ê²½ì„ ìƒê°í•˜ëŠ” ì‹ì‚¬ë¡œ ì‹œì‘í•´ë³´ì„¸ìš” ğŸŒ±"
            ],
            "afternoon": [
                "ì˜¤ëŠ˜ í•˜ë£¨ë„ ìˆ˜ê³  ë§ìœ¼ì…¨ì–´ìš”! ì ì‹¬ì€ ë§›ìˆê²Œ ë“œì…¨ë‚˜ìš”? ğŸ˜Š",
                "ë”°ëœ»í•œ ì˜¤í›„ë„¤ìš”! ì˜¤ëŠ˜ì˜ ì‹ì‚¬ëŠ” ì–´ë– ì…¨ëŠ”ì§€ ê¶ê¸ˆí•´ìš” ğŸ½ï¸",
                "ì ì‹¬ì‹œê°„ì´ ê¸°ë‹¤ë ¤ì§€ëŠ” ì˜¤í›„ì˜ˆìš”! ë§›ìˆëŠ” ì„ íƒ í•˜ì„¸ìš” âœ¨"
            ],
            "evening": [
                "í•˜ë£¨ ë§ˆë¬´ë¦¬ ì˜ í•˜ê³  ê³„ì‹œë‚˜ìš”? ì €ë… ì‹ì‚¬ë„ ê¸°ë¡í•´ë³´ì„¸ìš” ğŸŒ™",
                "í¸ì•ˆí•œ ì €ë… ì‹œê°„ì´ì—ìš”! ì˜¤ëŠ˜ í•˜ë£¨ ì •ë§ ê³ ìƒí•˜ì…¨ì–´ìš” ğŸ’š",
                "ì €ë…ë…¸ì„ì´ ì•„ë¦„ë‹¤ìš´ ì‹œê°„ì´ë„¤ìš”! ì˜¤ëŠ˜ì˜ ë§ˆì§€ë§‰ ì‹ì‚¬ëŠ”? ğŸŒ†"
            ]
        }
        
        self.success_messages = {
            "meal_logged": [
                "í›Œë¥­í•´ìš”! ì˜¤ëŠ˜ë„ ì§€êµ¬ë¥¼ ì§€í‚¤ëŠ” ì„ íƒì„ í•˜ì…¨ë„¤ìš” ğŸŒ",
                "ë©‹ì§„ ê¸°ë¡ì´ì—ìš”! ì‘ì€ ì‹¤ì²œì´ í° ë³€í™”ë¥¼ ë§Œë“­ë‹ˆë‹¤ âœ¨",
                "ì˜í•˜ì…¨ì–´ìš”! ê¾¸ì¤€í•œ ê¸°ë¡ì´ ë¯¸ë˜ë¥¼ ë°”ê¿”ë‚˜ê°€ìš” ğŸ‘",
                "ì™„ë²½í•´ìš”! ì´ëŸ° ê´€ì‹¬ì´ ì§€êµ¬ë¥¼ ê±´ê°•í•˜ê²Œ ë§Œë“¤ì–´ìš” ğŸ’š",
                "ëŒ€ë‹¨í•´ìš”! í™˜ê²½ì„ ìƒê°í•˜ëŠ” ì—¬ëŸ¬ë¶„ì˜ ë§ˆìŒì´ ì•„ë¦„ë‹¤ì›Œìš” ğŸŒ±"
            ],
            "swap_accepted": [
                "ì™€! ì •ë§ í˜„ëª…í•œ ì„ íƒì´ì—ìš”! ì§€êµ¬ê°€ ë¯¸ì†Œì§“ê³  ìˆì„ ê±°ì˜ˆìš” ğŸ˜Š",
                "í›Œë¥­í•œ ê²°ì •ì´ì—ìš”! ì´ëŸ° ì‘ì€ ë³€í™”ê°€ ì„¸ìƒì„ ë°”ê¿”ë‚˜ê°€ìš” ğŸŒ",
                "ë©‹ì ¸ìš”! í™˜ê²½ì„ ìƒê°í•˜ëŠ” ì„ íƒì— ë°•ìˆ˜ë¥¼ ë³´ë‚´ë“œë ¤ìš” ğŸ‘",
                "ì¢‹ì€ ì„ íƒì´ì—ìš”! ë¯¸ë˜ ì„¸ëŒ€ê°€ ê³ ë§ˆì›Œí•  ê±°ì˜ˆìš” ğŸŒ±",
                "ì™„ë²½í•´ìš”! ì§€ì† ê°€ëŠ¥í•œ ë¯¸ë˜ë¥¼ í•¨ê»˜ ë§Œë“¤ì–´ê°€ìš” âœ¨"
            ],
            "challenge_completed": [
                "ì¶•í•˜í•´ìš”! ì±Œë¦°ì§€ ì™„ì„±! ì •ë§ ìë‘ìŠ¤ëŸ¬ì›Œìš” ğŸ‰",
                "ì™€! í•´ë‚´ì…¨ë„¤ìš”! ì´ëŸ° ë…¸ë ¥ì´ ì§„ì§œ ë©‹ì ¸ìš” ğŸ†",
                "ëŒ€ì„±ê³µ! ê¾¸ì¤€í•œ ë…¸ë ¥ì˜ ê²°ê³¼ë„¤ìš”! ğŸ‘‘",
                "ì™„ë²½í•´ìš”! ë„ì „ ì •ì‹ ì´ ë¹›ë‚˜ëŠ” ìˆœê°„ì´ì—ìš” â­",
                "í›Œë¥­í•´ìš”! ì´ëŸ° ì‹¤ì²œë ¥ì´ ì„¸ìƒì„ ë°”ê¿”ë‚˜ê°€ìš” ğŸ’ª"
            ]
        }
        
        self.encouragement_messages = {
            "low_carbon_choice": [
                "ì§€ê¸ˆ ì„ íƒí•˜ì‹  ìŒì‹, ì§€êµ¬ì—ê²Œ ì •ë§ ì¢‹ì€ ì„ íƒì´ì—ìš”! ğŸŒ¿",
                "í™˜ê²½ì„ ìƒê°í•œ ë©‹ì§„ ì„ íƒì´ë„¤ìš”! ê³„ì† ì´ë ‡ê²Œ í•´ì£¼ì„¸ìš” ğŸ’š",
                "ì¹œí™˜ê²½ ì‹ë‹¨ ì‹¤ì²œ! ì‘ì€ ë³€í™”ê°€ í° ì˜ë¯¸ë¥¼ ë§Œë“¤ì–´ìš” ğŸŒ±",
                "ì§€êµ¬ë¥¼ ì‚¬ë‘í•˜ëŠ” ë§ˆìŒì´ ëŠê»´ì ¸ìš”! ê³ ë§ˆì›Œìš” ğŸŒ"
            ],
            "improvement_needed": [
                "ê´œì°®ì•„ìš”! ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ë¼ìš”. ì¡°ê¸ˆì”© ë‚˜ì•„ê°€ë©´ ë˜ë‹ˆê¹Œìš” ğŸ˜Š",
                "ì‹œì‘ì´ ë°˜ì´ì—ìš”! ì´ë¯¸ í™˜ê²½ì„ ìƒê°í•˜ê³  ê³„ì‹œë‹ˆê¹Œìš” âœ¨",
                "ì²œì²œíˆ í•´ë„ ê´œì°®ì•„ìš”! ê¾¸ì¤€í•¨ì´ ë” ì¤‘ìš”í•´ìš” ğŸ¢",
                "ì‘ì€ ë³€í™”ë¶€í„° ì‹œì‘í•´ë³´ì„¸ìš”! ì—¬ëŸ¬ë¶„ì„ ì‘ì›í•´ìš” ğŸ’ª",
                "ì‹¤ìˆ˜ëŠ” ì„±ì¥ì˜ ê¸°íšŒì˜ˆìš”! ë‹¤ìŒì—” ë” ì¢‹ì€ ì„ íƒí•˜ì‹¤ ê±°ì˜ˆìš” ğŸŒ±"
            ],
            "streak_motivation": [
                "ì—°ì† ê¸°ë¡ ëŒ€ë‹¨í•´ìš”! ì´ëŸ° ê¾¸ì¤€í•¨ì´ ë³€í™”ë¥¼ ë§Œë“¤ì–´ìš” ğŸ”¥",
                "ë§¤ì¼ë§¤ì¼ ì‹¤ì²œí•˜ëŠ” ëª¨ìŠµì´ ì •ë§ ë©‹ì ¸ìš”! ê³„ì†í•´ì£¼ì„¸ìš” ğŸ“…",
                "ê¾¸ì¤€í•œ ê¸°ë¡! ìŠµê´€ì˜ í˜ì„ ë³´ì—¬ì£¼ê³  ê³„ì‹œë„¤ìš” ğŸ’ª",
                "ì¤‘ë‹¨ ì—†ëŠ” ì‹¤ì²œ! ì§„ì •í•œ í™˜ê²½ ì§€í‚´ì´ì‹œë„¤ìš” ğŸ‘‘"
            ]
        }
        
        self.insight_messages = {
            "carbon_savings": [
                "ì™€! ì§€ê¸ˆê¹Œì§€ {amount}kgì˜ íƒ„ì†Œë¥¼ ì ˆì•½í•˜ì…¨ì–´ìš”! ë‚˜ë¬´ {trees}ê·¸ë£¨ë¥¼ ì‹¬ì€ íš¨ê³¼ì˜ˆìš” ğŸŒ³",
                "ëŒ€ë‹¨í•´ìš”! {amount}kg íƒ„ì†Œ ì ˆì•½ì€ ìë™ì°¨ {km}km ëœ íƒ€ê¸°ì™€ ê°™ì€ íš¨ê³¼ì˜ˆìš” ğŸš—",
                "í›Œë¥­í•´ìš”! {amount}kgì˜ íƒ„ì†Œë¥¼ ì¤„ì´ì…¨ë„¤ìš”! ì§€êµ¬ê°€ ìˆ¨ì‰¬ê¸° í¸í•´ì¡Œì–´ìš” ğŸŒ"
            ],
            "weekly_summary": [
                "ì´ë²ˆ ì£¼ë„ ìˆ˜ê³ í•˜ì…¨ì–´ìš”! {meals}ë²ˆì˜ ê¸°ë¡ìœ¼ë¡œ {carbon}kg íƒ„ì†Œë¥¼ ì ˆì•½í–ˆì–´ìš” ğŸ“Š",
                "í•œ ì£¼ ë™ì•ˆ {meals}ë²ˆ ê¸°ë¡í•˜ë©° í™˜ê²½ì„ ìƒê°í•´ì£¼ì…¨ë„¤ìš”! ê³ ë§ˆì›Œìš” ğŸ’š",
                "ì¼ì£¼ì¼ ìš”ì•½: {meals}ë²ˆì˜ ì„ íƒìœ¼ë¡œ {carbon}kg íƒ„ì†Œ ì ˆì•½! ë©‹ì ¸ìš” âœ¨"
            ],
            "milestone_reached": [
                "ì¶•í•˜í•´ìš”! {milestone} ë‹¬ì„±! ì •ë§ ìë‘ìŠ¤ëŸ¬ìš´ ìˆœê°„ì´ì—ìš” ğŸ‰",
                "ì™€! {milestone} ì™„ì„±! ì´ëŸ° ì„±ì·¨ê°€ ì„¸ìƒì„ ë°”ê¿”ë‚˜ê°€ìš” ğŸ†",
                "ëŒ€ë‹¨í•´ìš”! {milestone} ë„ë‹¬! ê¾¸ì¤€í•œ ë…¸ë ¥ì˜ ê²°ì‹¤ì´ë„¤ìš” ğŸ‘"
            ]
        }
        
        self.tips_messages = [
            "ğŸ’¡ ì†Œê³ ê¸° ëŒ€ì‹  ë‹­ê³ ê¸°ë¥¼ ì„ íƒí•˜ë©´ 50% ì´ìƒ íƒ„ì†Œë¥¼ ì ˆì•½í•  ìˆ˜ ìˆì–´ìš”!",
            "ğŸŒ± ì œì²  ìŒì‹ì„ ì„ íƒí•˜ë©´ ë§›ë„ ì¢‹ê³  í™˜ê²½ì—ë„ ì¢‹ì•„ìš”!",
            "ğŸŸ ì¼ì£¼ì¼ì— 2ë²ˆ ìƒì„  ìš”ë¦¬ë¥¼ ë¨¹ìœ¼ë©´ íƒ„ì†Œ ë°œìêµ­ì„ í¬ê²Œ ì¤„ì¼ ìˆ˜ ìˆì–´ìš”!",
            "ğŸ¥¬ ì±„ì†Œë¥¼ ë” ë§ì´ ë¨¹ìœ¼ë©´ ê±´ê°•ê³¼ í™˜ê²½, ë‘ ë§ˆë¦¬ í† ë¼ë¥¼ ì¡ì„ ìˆ˜ ìˆì–´ìš”!",
            "â™»ï¸ ìŒì‹ë¬¼ ì“°ë ˆê¸°ë¥¼ ì¤„ì´ëŠ” ê²ƒë„ íƒ„ì†Œ ì ˆì•½ì˜ ì¤‘ìš”í•œ ë°©ë²•ì´ì—ìš”!",
            "ğŸŒ¾ í†µê³¡ë¬¼ì„ ì„ íƒí•˜ë©´ ì˜ì–‘ë„ í’ë¶€í•˜ê³  í™˜ê²½ì—ë„ ë„ì›€ì´ ë¼ìš”!",
            "ğŸ„ ë²„ì„¯ë¥˜ëŠ” ë‹¨ë°±ì§ˆë„ í’ë¶€í•˜ê³  íƒ„ì†Œ ë°œìêµ­ì´ ë‚®ì€ í›Œë¥­í•œ ì‹ì¬ë£Œì˜ˆìš”!",
            "ğŸ¥— ë¡œì»¬ í‘¸ë“œë¥¼ ì„ íƒí•˜ë©´ ìš´ì†¡ ê³¼ì •ì˜ íƒ„ì†Œ ë°°ì¶œì„ ì¤„ì¼ ìˆ˜ ìˆì–´ìš”!"
        ]

    def get_greeting_message(self) -> str:
        """ì‹œê°„ëŒ€ë³„ ì¸ì‚¬ë§ ë°˜í™˜"""
        hour = datetime.now().hour
        
        if 5 <= hour < 12:
            time_category = "morning"
        elif 12 <= hour < 18:
            time_category = "afternoon"
        else:
            time_category = "evening"
            
        return random.choice(self.greeting_messages[time_category])
    
    def get_success_message(self, action_type: str) -> str:
        """ì„±ê³µ ë©”ì‹œì§€ ë°˜í™˜"""
        messages = self.success_messages.get(action_type, self.success_messages["meal_logged"])
        return random.choice(messages)
    
    def get_encouragement_message(self, context: str) -> str:
        """ê²©ë ¤ ë©”ì‹œì§€ ë°˜í™˜"""
        messages = self.encouragement_messages.get(context, self.encouragement_messages["low_carbon_choice"])
        return random.choice(messages)
    
    def get_insight_message(self, insight_type: str, **kwargs) -> str:
        """ì¸ì‚¬ì´íŠ¸ ë©”ì‹œì§€ ë°˜í™˜"""
        messages = self.insight_messages.get(insight_type, [])
        if not messages:
            return "ê³„ì†í•´ì„œ í™˜ê²½ì„ ìƒê°í•´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”! ğŸŒ"
        
        template = random.choice(messages)
        try:
            return template.format(**kwargs)
        except KeyError:
            return template
    
    def get_tip_message(self) -> str:
        """ëœë¤ íŒ ë©”ì‹œì§€ ë°˜í™˜"""
        return random.choice(self.tips_messages)
    
    def get_personalized_recommendation_message(
        self, 
        user_name: str = "",
        food_from: str = "",
        food_to: str = "",
        carbon_reduction: float = 0,
        meal_pattern: str = ""
    ) -> str:
        """ê°œì¸í™”ëœ ì¶”ì²œ ë©”ì‹œì§€ ìƒì„±"""
        
        base_messages = [
            f"{food_to}ë¡œ ë°”ê¾¸ë©´ {carbon_reduction:.0f}% íƒ„ì†Œë¥¼ ì ˆì•½í•  ìˆ˜ ìˆì–´ìš”!",
            f"{food_to}ëŠ” ë§›ë„ ì¢‹ê³  í™˜ê²½ì—ë„ ì¢‹ì€ ì„ íƒì´ì—ìš”!",
            f"{food_to}ë¡œ ê±´ê°•í•˜ê³  ì¹œí™˜ê²½ì ì¸ ì‹ì‚¬ë¥¼ í•´ë³´ì„¸ìš”!",
        ]
        
        # íŒ¨í„´ ê¸°ë°˜ ê°œì¸í™”
        if meal_pattern == "meat_lover":
            personalized_part = " ê³ ê¸° ìš”ë¦¬ë¥¼ ìì£¼ ë“œì‹œëŠ”êµ°ìš”! ê°€ë”ì€ ì´ëŸ° ì„ íƒë„ ì–´ë– ì„¸ìš”? ğŸ˜Š"
        elif meal_pattern == "health_conscious":
            personalized_part = " ê±´ê°•ì„ ìƒê°í•˜ì‹œëŠ” ë¶„ì´ì‹œêµ°ìš”! ì´ ì„ íƒì´ ë” ë„ì›€ì´ ë  ê±°ì˜ˆìš” ğŸ’ª"
        elif meal_pattern == "frequent_logger":
            personalized_part = " ê¾¸ì¤€í•œ ê¸°ë¡ ìŠµê´€ì´ ë©‹ì ¸ìš”! ì´ëŸ° ì„ íƒìœ¼ë¡œ ë” ë°œì „í•´ë³´ì„¸ìš” ğŸŒŸ"
        else:
            personalized_part = " í™˜ê²½ì„ ìƒê°í•˜ëŠ” ë§ˆìŒì´ ì•„ë¦„ë‹¤ì›Œìš”! ğŸ’š"
        
        base_message = random.choice(base_messages)
        return base_message + personalized_part
    
    def get_error_message(self, error_type: str) -> str:
        """ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜ (ê²©ë ¤í•˜ëŠ” í†¤ìœ¼ë¡œ)"""
        error_messages = {
            "network_error": "ì ì‹œ ì—°ê²°ì´ ì›í™œí•˜ì§€ ì•Šë„¤ìš”. ì¡°ê¸ˆ í›„ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”! ğŸ˜Š",
            "validation_error": "ì•—! ì…ë ¥í•˜ì‹  ë‚´ìš©ì„ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•´ì£¼ì„¸ìš” âœ¨",
            "server_error": "ì„œë²„ì— ì‘ì€ ë¬¸ì œê°€ ìˆë„¤ìš”. ê¸ˆë°© í•´ê²°ë  ê±°ì˜ˆìš”! ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš” ğŸ™",
            "not_found": "ì°¾ìœ¼ì‹œëŠ” ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ìš”. ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ì‹œë„í•´ë³´ì„¸ìš”! ğŸ’¡",
            "general": "ì˜ˆìƒì¹˜ ëª»í•œ ì¼ì´ ë°œìƒí–ˆë„¤ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì‹œë©´ ë  ê±°ì˜ˆìš”! í™”ì´íŒ…! ğŸ’ª"
        }
        
        return error_messages.get(error_type, error_messages["general"])

# ì „ì—­ ë©”ì‹œì§€ ìƒì„±ê¸° ì¸ìŠ¤í„´ìŠ¤
korean_messages = KoreanMessageGenerator()

def get_korean_message(category: str, message_type: str = "", **kwargs) -> str:
    """í•œêµ­ì–´ ë©”ì‹œì§€ ì¡°íšŒ í—¬í¼ í•¨ìˆ˜"""
    if category == "greeting":
        return korean_messages.get_greeting_message()
    elif category == "success":
        return korean_messages.get_success_message(message_type)
    elif category == "encouragement":
        return korean_messages.get_encouragement_message(message_type)
    elif category == "insight":
        return korean_messages.get_insight_message(message_type, **kwargs)
    elif category == "tip":
        return korean_messages.get_tip_message()
    elif category == "error":
        return korean_messages.get_error_message(message_type)
    elif category == "recommendation":
        return korean_messages.get_personalized_recommendation_message(**kwargs)
    else:
        return "í•¨ê»˜ ì§€êµ¬ë¥¼ ì§€ì¼œë‚˜ê°€ìš”! ğŸŒâœ¨" 